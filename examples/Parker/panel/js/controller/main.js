var Module=angular.module("ReactPS",["ngRoute"]);Module.config(["$routeProvider",function(t){t.when("/login",{templateUrl:"templates/login.html",controller:"LoginController"}).when("/expire/:id",{templateUrl:"templates/expire.html",controller:"ExpireController"}).when("/panel",{templateUrl:"templates/panel.html",controller:"PanelController"}).when("/setting",{templateUrl:"templates/setting.html",controller:"SettingController"}).when("/user",{templateUrl:"templates/user.html",controller:"UserController"})}]),Module.controller("RootController",["$scope","$location",function(t,e){function n(){app.fileExists(app.getConfigFile()).then(function(){app.readFile(app.getConfigFile()).then(function(n){return t.config=JSON.parse(n),e.path("/panel"),t.$apply(),void 0==t.config.token?(app.showToast("登录过期, 请重新登录"),void $s.logout()):(o(),void a())})},function(){e.path("/login"),t.$apply()})}function o(){var e="http://www.cutterman.cn/client/check_login";app.post(e,t.config).then(function(e){11==e.errno&&(app.showToast(e.info),setTimeout(function(){app.deleteFile(app.getConfigFile()).then(function(){t.$emit("LOGOUT_SUCCESS"),t.$apply()})},2e3))},function(t){})}function a(){var n=0;localStorage.getItem("UPDATE_CHECK_TIME")&&(n=parseInt(localStorage.getItem("UPDATE_CHECK_TIME")));var o=(new Date).getTime();if(o-n>432e5){localStorage.setItem("UPDATE_CHECK_TIME",o+"");var a="http://www.cutterman.cn/client/checkupdate";$.post(a,{app:app.id,version:app.versionCode,uid:t.config.uid},function(n){0==n.errno&&n.update>0&&(e.path("/user").search({hasUpdate:!0,new_version:n.version_name,url:n.download_url}),t.$apply())})}}t.config={isLogin:!1,name:"未登录",avatar:"./img/avatar.png",version:app.versionCode},t.$on("USER_ACTIVE",function(n,o){setTimeout(function(){e.path("/active"),t.$apply()},100)}),t.$on("LOGIN_SUCCESS",function(n,o){t.isLogin=!0,t.config=o,setTimeout(function(){e.path("/panel"),t.$apply()},100)}),t.$on("GO_PANEL",function(n,o){setTimeout(function(){e.path("/panel"),t.$apply()},100)}),t.$on("GO_SETTING",function(n,o){setTimeout(function(){e.path("/setting"),t.$apply()},100)}),t.$on("GO_USER",function(n,o){setTimeout(function(){e.path("/user"),t.$apply()},100)}),t.$on("LOAD_USER_INFO",function(e,n){setTimeout(function(){app.evalScript('getUserInfo("'+t.config.token+'")')},100)}),t.$on("LOGOUT_SUCCESS",function(t){location.hash="",location.reload(!0)}),n(),app.csInterface.addEventListener("PARKER_PANEL_EVENT",function(n){var o=n.data;1010==o.action&&(e.path("/expire/"+t.config.uid),t.$apply())})}]);